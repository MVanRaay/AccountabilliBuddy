<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Search for Friends</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>

<div class="container py-3">

    <!-- Header -->
    <div class="text-center mb-3 mt-5">
        <h4 class="fw-bold">Find Friends</h4>
        <p class="text-muted small">Search by name or email</p>
    </div>

    <!-- Search Bar -->
    <div class="input-group mb-3">
        <span class="input-group-text">üîç</span>
        <input
                id="searchInput"
                type="text"
                class="form-control"
                placeholder="Type a username..."
                autocomplete="off">
    </div>

    <!-- Results List -->
    <div id="resultsContainer" class="list-group shadow-sm">
        <div class="list-group-item text-muted text-center">
            Start typing to search
        </div>
    </div>

</div>

<script>
    const input = document.getElementById("searchInput");
    const resultsContainer = document.getElementById("resultsContainer");

    let debounceTimer;

    input.addEventListener("input", () => {
        clearTimeout(debounceTimer);

        debounceTimer = setTimeout(() => {
            const searchTerm = input.value.trim();

            if (searchTerm.length === 0) {
                resultsContainer.innerHTML =
                    `<div class="list-group-item text-muted text-center">
                        Start typing to search
                     </div>`;
                return;
            }

            fetch(`/friends/search?searchTerm=${encodeURIComponent(searchTerm)}`)
                .then(response => response.json())
                .then(users => renderResults(users))
                .catch(() => {
                    resultsContainer.innerHTML =
                        `<div class="list-group-item text-danger text-center">
                            Error loading results
                         </div>`;
                });

        }, 300); // debounce delay
    });

    function renderResults(users) {
        if (!users || users.length === 0) {
            resultsContainer.innerHTML =
                `<div class="list-group-item text-muted text-center">
                    No users found
                 </div>`;
            return;
        }

        let html = "";
        users.forEach(user => {
            html += `
                <div class="list-group-item d-flex align-items-center justify-content-between">
                    <div>
                        <div class="fw-semibold">${user.firstName} ${user.lastName}</div>
                        <small class="text-muted">${user.email || ""}</small>
                    </div>
                    <button class="btn btn-sm btn-outline-primary">
                        Add
                    </button>
                </div>
            `;
        });

        resultsContainer.innerHTML = html;
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>